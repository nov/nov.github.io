<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RP Frame</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://nov.github.io/js/jquery.cookie.js"></script>
</head>
<body>
  <script>
    var session_changed = false;
    var op_origin = "https://nov.github.io";

    var to_op = function () {
      var session_state = $.cookie('session-state');
      var op_frame = window.parent.document.getElementById("op-frame").contentWindow;
      op_frame.postMessage(session_state, op_origin);
    }

    var from_op = function (e) {
      if (e.origin !== op_origin) {
        return;
      }
      console.info(e.data);
      if (e.data == "changed") {
        window.parent.session_changed();
      }
    }
    window.addEventListener("message", from_op, false);

    var loop = function () {
      to_op();
      setInterval(function () {
        loop, 3000
      });
    }
    loop()
  </script>
</body>
</html>
